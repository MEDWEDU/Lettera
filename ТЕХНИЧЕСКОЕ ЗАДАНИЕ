ТЕХНИЧЕСКОЕ ЗАДАНИЕ: LETTERA

Версия 1.0 — Финальная, согласованная
1. ЦЕЛЬ
Создать мессенджер, где пользователи могут легко получать обратную связь от профессионалов.
Акцент:
Поиск по профилям (место работы, навыки, категория деятельности).
Четкий статус ожидания ответа.
Быстрый, красивый, безопасный чат с медиа.
2. ТЕХНОЛОГИЧЕСКИЙ СТЕК
Уровень
Технологии
Фронтенд
Next.js 16 (App Router), TypeScript, Tailwind CSS, Redux Toolkit
Бэкенд
Node.js, Express, TypeScript
База данных
MongoDB (Atlas или self-hosted)
Realtime
Socket.io (WebSocket over HTTP fallback)
Кэш/Сессии
Redis
Хранение
AWS S3 (или MinIO, если self-hosted)
Тестирование
Jest (unit/integration), Cypress (e2e), Artillery (нагрузка)
Документация
Swagger UI (через swagger-jsdoc)
CI/CD
GitHub Actions → Docker → Kubernetes (или PM2 + Nginx для MVP)



3. МОДЕЛИ БД (MONGODB)
Все коллекции:
users
_id: ObjectId
email: string, unique, index
passwordHash: string
firstName, lastName: string
avatarUrl: string (S3 path)
profile: {
&nbsp;&nbsp;position: string,
&nbsp;&nbsp;company: string,
&nbsp;&nbsp;category: string (IT, Marketing, Design...),
&nbsp;&nbsp;skills: [string]
}
createdAt, updatedAt: Date
chats
_id: ObjectId
participants: [ObjectId] (ref: users)
type: "private" | "group"
lastMessage: { content: string, senderId: ObjectId, timestamp: Date }
unreadCount: { [userId]: number }
messages
_id: ObjectId
chatId: ObjectId (ref: chats)
senderId: ObjectId (ref: users)
content: string
media: { type: "image"|"audio"|"video", url: string }
editedAt: Date?
deletedFor: [ObjectId] // для soft delete
timestamp: Date, indexed
feedbackRequests
_id: ObjectId
messageId: ObjectId
requesterId: ObjectId
status: "pending" | "responded" | "expired"
expiresAt: Date
searchHistory
userId: ObjectId
query: { category, company, skills }
timestamp: Date
4. ФУНКЦИОНАЛ — ПОЛЬЗОВАТЕЛЬСКИЕ СЦЕНАРИИ
Аутентификация
Регистрация: email + пароль → подтверждение на почту → заполнение профиля (обязательно: имя, фамилия, категория, должность, компания).
Вход: email/пароль или Google OAuth.
Сброс пароля: email → токен → смена. После смены — logout на всех устройствах (кроме текущего).
Валидация: пароль ≥8 символов, спецсимвол, цифра. Email — RFC-валидация.
Поиск пользователей
Фильтры:
category (мультивыбор: IT, Marketing...)
company (автокомплит по базе)
skills (мультивыбор, теги)
Интерфейс:
При вводе — дебаунс 300 мс.
У каждого фильтра — кнопка × (clear).
Кнопка «Сбросить всё» — очищает URL и фильтры.
Поиск идет по индексу profile.skills + текстовому индексу по profile.company.
Чаты и сообщения
Создание чата:
На профиле → «Написать» → создается приватный чат (если не существует).
Отправка:
Текст, изображения, аудио (до 2 мин), видео (до 100 МБ).
Оптимистичный UI: сообщение появляется сразу со статусом «sending…» → «sent»/«error».
Удаление:
Для себя: удаляется локально + API-запрос → обновление deletedFor.
Для всех: только если <24 ч. → WebSocket-событие message:deleted.
Редактирование: доступно 15 мин → флаг editedAt.
Обратная связь
Пользователь может пометить сообщение как «Ожидаю ответа» → создается запись в feedbackRequests с expiresAt = +7 дней.
Если ответ приходит — статус меняется на responded.
Если не ответили за 7 дней — expired, уведомление «Срок ожидания истек».
5. REALTIME — SOCKET.IO
Комнаты: один чат = одна комната (socket.join(chatId)).
События:
message:new → рассылка всем в чате.
message:deleted → синхронизация удаления.
user:online / user:offline → обновление статуса в чатах.
Reconnect:
При потере связи — автоматический reconnect с восстановлением комнат.
При восстановлении — запрос недостающих сообщений за offline-период.
6. UI/UX ТРЕБОВАНИЯ
Цвета:
Акцент: #2290FF (кнопки, иконки, активные состояния).
Фон чата: #F9FBFF.
Текст: #1A1A1A, второстепенный: #6B7280.
Оптимистичные обновления:
Нет спиннеров на всей странице — только локальные анимации (пунктир, прозрачность).
При ошибке — inline уведомление под полем/сообщением.
Адаптивность:
Поддержка 320px–1920px.
Мобильный: поиск в отдельном экране.
7. ТЕСТИРОВАНИЕ И КАЧЕСТВО
Unit-тесты (Jest):
Покрытие ≥90% для: auth, chat service, search.
E2E (Cypress):
Сценарии: регистрация → поиск → чат → удаление сообщения.
Тесты на оптимистичные обновления при медленном интернете.
Нагрузка (Artillery):
Минимум: 1000 одновременных WebSocket-соединений.
Целевой P95 latency: <300 мс.
Безопасность:
Проверка на NoSQL-инъекции, XSS, CSRF.
Все пароли — bcrypt (salt 12).
Сообщения — end-to-end шифрование (опционально в MVP, но архитектура должна поддерживать).
8. ДОКУМЕНТАЦИЯ
Swagger UI: /api-docs — автогенерация из JSDoc-комментариев в Express-роутах.
Пример эндпоинта:
/**
 * @swagger
 * /api/chats:
 *   post:
 *     summary: Создать новый чат
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               participantIds:
 *                 type: array
 *                 items:
 *                   type: string
 *     responses:
 *       201:
 *         description: Чат создан
 *         content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/Chat'
 */


9. MVP СПРИНТ-ПЛАН (6 НЕДЕЛЬ)
Неделя
Задачи
1–2
Auth (регистрация/вход), MongoDB-модели, базовый Next.js UI
3–4
Чаты (создание, отправка, получение), Socket.io интеграция
5
Поиск по профилям, фильтры, оптимистичные обновления
6
Тесты, Swagger, сборка, деплой MVP

